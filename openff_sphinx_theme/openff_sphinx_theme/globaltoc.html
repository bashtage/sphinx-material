{% set toctree = toctree(maxdepth=theme_globaltoc_depth|toint, collapse=theme_globaltoc_collapse|tobool, includehidden=theme_globaltoc_includehidden|tobool) %}
{% if toctree and sidebars and 'globaltoc.html' in sidebars %}
<nav class="menu ff-globaltoc">
  {% set toctree_nodes = derender_toc(toctree, False) %}
  {%- for item in toctree_nodes recursive %}
    {% if "caption" in item %}
      {% if not loop.first %}
        </ul>
      {% endif %}
      <p class="menu-label">{{ item.caption }}</p>
      <ul class="menu-list">
    {% else %}
      {% if loop.first %}
        <ul class="menu-list">
      {% endif %}
    <li>
      <a href="{{ item.href|e }}" class="{% if item.current %}is-active{% endif %}">{{ item.contents }}</a>
      {%- if item.children and 'localtoc.html' not in sidebars -%}
        <ul class="menu-list"> {{ loop(item.children) }}</ul>
      {%- endif %}
    {% endif %}
    </li>
  {%- endfor %}
  </ul>
</nav>
{% endif %}
